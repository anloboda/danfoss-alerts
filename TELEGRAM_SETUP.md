# Telegram Notifications Setup Guide

–¶—è —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –¥–æ–ø–æ–º–æ–∂–µ –≤–∞–º –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ Telegram —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –¥–ª—è Danfoss Alerts Service.

## –ü–µ—Ä–µ–≤–∞–≥–∏ Telegram —Å–ø–æ–≤—ñ—â–µ–Ω—å:

‚úÖ **–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ** - Telegram Bot API –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏–π  
‚úÖ **–ù–∞–¥—ñ–π–Ω–æ** - –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –Ω–∞–¥—Ö–æ–¥—è—Ç—å –º–∏—Ç—Ç—î–≤–æ  
‚úÖ **–ù–µ –ø–æ—Ç—Ä–∞–ø–ª—è—î –≤ —Å–ø–∞–º** - –ù–∞ –≤—ñ–¥–º—ñ–Ω—É –≤—ñ–¥ email  
‚úÖ **–ó—Ä—É—á–Ω–æ** - –û—Ç—Ä–∏–º—É—î—Ç–µ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä—è–º–æ –≤ Telegram  

## –ö—Ä–æ–∫ 1: –°—Ç–≤–æ—Ä–∏—Ç–∏ Telegram –±–æ—Ç–∞

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ Telegram —ñ –∑–Ω–∞–π–¥—ñ—Ç—å **@BotFather**
2. –ù–∞–¥—ñ—à–ª—ñ—Ç—å –∫–æ–º–∞–Ω–¥—É `/newbot`
3. –í–≤–µ–¥—ñ—Ç—å —ñ–º'—è –¥–ª—è –±–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: `Danfoss Alerts Bot`)
4. –í–≤–µ–¥—ñ—Ç—å username –¥–ª—è –±–æ—Ç–∞ (–º–∞—î –∑–∞–∫—ñ–Ω—á—É–≤–∞—Ç–∏—Å—è –Ω–∞ `bot`, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥: `danfoss_alerts_bot`)
5. BotFather –Ω–∞–¥–∞—Å—Ç—å –≤–∞–º **Bot Token** (–≤–∏–≥–ª—è–¥–∞—î —è–∫ `123456789:ABCdefGHIjklMNOpqrsTUVwxyz`)

**–ó–±–µ—Ä–µ–∂—ñ—Ç—å —Ü–µ–π —Ç–æ–∫–µ–Ω!** –í—ñ–Ω –ø–æ—Ç—Ä—ñ–±–µ–Ω –¥–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è.

## –ö—Ä–æ–∫ 2: –û—Ç—Ä–∏–º–∞—Ç–∏ Chat ID

Chat ID - —Ü–µ —á–∏—Å–ª–æ–≤–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä —á–∞—Ç—É, –∫—É–¥–∏ –±–æ—Ç –±—É–¥–µ –Ω–∞–¥—Å–∏–ª–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è. –í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏:

- **–û—Å–æ–±–∏—Å—Ç–∏–π —á–∞—Ç** –∑ –±–æ—Ç–æ–º (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)
- **–ì—Ä—É–ø–æ–≤–∏–π —á–∞—Ç** (—è–∫—â–æ —Ö–æ—á–µ—Ç–µ –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –≤ –≥—Ä—É–ø—ñ)

### –û—Ç—Ä–∏–º–∞—Ç–∏ Chat ID: –û—Å–æ–±–∏—Å—Ç–∏–π —á–∞—Ç –∑ –±–æ—Ç–æ–º

1. –ó–Ω–∞–π–¥—ñ—Ç—å —Å–≤–æ–≥–æ –±–æ—Ç–∞ –≤ Telegram (–∑–∞ username, —è–∫–∏–π –≤–∏ —Å—Ç–≤–æ—Ä–∏–ª–∏)
2. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **Start** –∞–±–æ –Ω–∞–¥—ñ—à–ª—ñ—Ç—å `/start`
3. –¢–µ–ø–µ—Ä –∑–Ω–∞–π–¥—ñ—Ç—å –±–æ—Ç–∞ **@userinfobot** –≤ Telegram
4. –ù–∞–¥—ñ—à–ª—ñ—Ç—å `/start` –±–æ—Ç—É @userinfobot
5. –í—ñ–Ω –ø–æ–∫–∞–∂–µ –≤–∞–º –≤–∞—à **Chat ID** (–≤–∏–≥–ª—è–¥–∞—î —è–∫ `123456789`)

**–ó–±–µ—Ä–µ–∂—ñ—Ç—å —Ü–µ–π Chat ID!**

### –í–∞—Ä—ñ–∞–Ω—Ç B: –ß–µ—Ä–µ–∑ API (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∏–π —Å–ø–æ—Å—ñ–±)

1. –ü–æ—á–∞—Ç–∏ —á–∞—Ç –∑ –±–æ—Ç–æ–º (–Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ `/start`)
2. –í—ñ–¥–∫—Ä–∏—Ç–∏ –≤ –±—Ä–∞—É–∑–µ—Ä—ñ:
   ```
   https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates
   ```
   (–∑–∞–º—ñ–Ω—ñ—Ç—å `<YOUR_BOT_TOKEN>` –Ω–∞ —Ç–æ–∫–µ–Ω –∑ –∫—Ä–æ–∫—É 1)
3. –ó–Ω–∞–π—Ç–∏ –≤ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –ø–æ–ª–µ `"chat":{"id":123456789}` - —Ü–µ –≤–∞—à Chat ID

## –ö—Ä–æ–∫ 3: –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –≤ AWS

–í–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–¥–∞—Ç–∏ Bot Token —Ç–∞ Chat ID —è–∫ environment variables –∞–±–æ –≤ Parameter Store.

### –í–∞—Ä—ñ–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ Parameter Store (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ - –±–µ–∑–ø–µ—á–Ω—ñ—à–µ)

```bash
# –ó–±–µ—Ä–µ–≥—Ç–∏ Bot Token
aws ssm put-parameter \
  --name /DanfossAlertsStack/telegram-bot-token \
  --value "YOUR_BOT_TOKEN_HERE" \
  --type SecureString \
  --overwrite

# –ó–±–µ—Ä–µ–≥—Ç–∏ Chat IDs (—á–µ—Ä–µ–∑ –∫–æ–º—É –¥–ª—è –∫—ñ–ª—å–∫–æ—Ö –æ—Ç—Ä–∏–º—É–≤–∞—á—ñ–≤)
aws ssm put-parameter \
  --name /DanfossAlertsStack/telegram-chat-ids \
  --value "331848921,563647896" \
  --type SecureString \
  --overwrite
```

–ü–æ—Ç—ñ–º –≤ `lib/danfoss-alerts-stack.ts` –¥–æ–¥–∞–π—Ç–µ –≤ environment variables Lambda:

```typescript
environment: {
  // ... existing variables
  TELEGRAM_BOT_TOKEN_PARAM_NAME: "/DanfossAlertsStack/telegram-bot-token",
  TELEGRAM_CHAT_ID_PARAM_NAME: "/DanfossAlertsStack/telegram-chat-id",
},
```

### –í–∞—Ä—ñ–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ Environment Variables (–ø—Ä–æ—Å—Ç—ñ—à–µ, –∞–ª–µ –º–µ–Ω—à –±–µ–∑–ø–µ—á–Ω–æ)

–í `lib/danfoss-alerts-stack.ts` –¥–æ–¥–∞–π—Ç–µ –≤ environment variables Lambda:

```typescript
environment: {
  // ... existing variables
  TELEGRAM_BOT_TOKEN: "YOUR_BOT_TOKEN_HERE",
  TELEGRAM_CHAT_IDS: "331848921,563647896", // Chat IDs —á–µ—Ä–µ–∑ –∫–æ–º—É
},
```

**‚ö†Ô∏è –£–≤–∞–≥–∞:** –ù–µ –∫–æ–º—ñ—Ç—å—Ç–µ —Ç–æ–∫–µ–Ω —É git! –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ Parameter Store –¥–ª—è –±–µ–∑–ø–µ–∫–∏.

## –ö—Ä–æ–∫ 4: –†–æ–∑–≥–æ—Ä–Ω—É—Ç–∏ –∑–º—ñ–Ω–∏

```bash
npm run build
cdk deploy
```

## –ö—Ä–æ–∫ 5: –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏

1. –ó–∞–ø—É—Å—Ç—ñ—Ç—å Lambda —Ñ—É–Ω–∫—Ü—ñ—é –≤—Ä—É—á–Ω—É (—á–µ—Ä–µ–∑ AWS Console) –∞–±–æ –¥–æ—á–µ–∫–∞–π—Ç–µ—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫—É
2. –Ø–∫—â–æ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –ø–µ—Ä–µ–≤–∏—â—É—î –ø–æ—Ä—ñ–≥, –≤–∏ –ø–æ–≤–∏–Ω–Ω—ñ –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ Telegram!

## –ü—Ä–∏–∫–ª–∞–¥ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ Telegram:

```
üå°Ô∏è Danfoss Temperature Warning

Hello Anna,

Floor temperature exceeded 27¬∞C threshold.

Devices with elevated temperatures:
‚Ä¢ –°–ø–∞–ª—å–Ω—è: 28.5¬∞C
‚Ä¢ –í—ñ—Ç–∞–ª—å–Ω—è: 27.9¬∞C

Please check your Danfoss floor heating system when convenient.
```

## Troubleshooting

### –ù–µ –ø—Ä–∏—Ö–æ–¥—è—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è

1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ –≤–∏ –ø–æ—á–∞–ª–∏ —á–∞—Ç –∑ –±–æ—Ç–æ–º (–Ω–∞–¥—ñ—Å–ª–∞–ª–∏ `/start`)
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ—Å—Ç—å Bot Token —Ç–∞ Chat ID
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ CloudWatch –ª–æ–≥–∏ Lambda —Ñ—É–Ω–∫—Ü—ñ—ó
4. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ –±–æ—Ç –Ω–µ –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∏–π

### –ü–æ–º–∏–ª–∫–∞ "Unauthorized" –∞–±–æ "chat not found"

- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ—Å—Ç—å Chat ID
- –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –≤–∏ –ø–æ—á–∞–ª–∏ —á–∞—Ç –∑ –±–æ—Ç–æ–º

### –ü–æ–º–∏–ª–∫–∞ "Invalid token"

- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ—Å—Ç—å Bot Token
- –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ —Ç–æ–∫–µ–Ω –Ω–µ –º–∞—î –ø—Ä–æ–±—ñ–ª—ñ–≤ –∞–±–æ –∑–∞–π–≤–∏—Ö —Å–∏–º–≤–æ–ª—ñ–≤

## –í–∏–º–∫–Ω–µ–Ω–Ω—è Telegram —Å–ø–æ–≤—ñ—â–µ–Ω—å

–Ø–∫—â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–º–∫–Ω—É—Ç–∏ Telegram —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è, –ø—Ä–æ—Å—Ç–æ –≤–∏–¥–∞–ª—ñ—Ç—å –∞–±–æ –∑–∞–ª–∏—à—Ç–µ –ø–æ—Ä–æ–∂–Ω—ñ–º–∏ environment variables:
- `TELEGRAM_BOT_TOKEN` / `TELEGRAM_BOT_TOKEN_PARAM_NAME`
- `TELEGRAM_CHAT_ID` / `TELEGRAM_CHAT_ID_PARAM_NAME`

Email —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–æ–¥–æ–≤–∂–∞—Ç—å –ø—Ä–∞—Ü—é–≤–∞—Ç–∏.

